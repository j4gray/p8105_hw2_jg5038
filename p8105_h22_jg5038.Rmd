---
title: "Homework 2"
author: Julia Gray
output: github_document
date: "09-24-25"
---
```{r echo=TRUE, message=FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1

First, let's check if in original dataset there are any rows where both prez_gop and prez_dem == 1

```{r message=FALSE}
filter(
  read_csv(file="./data/fivethirtyeight_datasets/pols-month.csv"), 
  prez_gop + prez_dem > 1)
```

We can see that there are 5 rows where prez_gop == 2 (from August-December 1974, which is when Ford took over after Nixon resigned) so we must take that into account when assigning president column.

Import and clean pos_month data
```{r message=FALSE}
pols_df = read_csv(file="./data/fivethirtyeight_datasets/pols-month.csv") |> 
  janitor::clean_names() |> 
  separate(
    col="mon",
    into=c("year", "month", "day"),
    sep="-"
  ) |> 
  mutate(
    month = 
      case_match(
        month, 
        "01" ~ "jan", 
        "02" ~ "feb",
        "03" ~ "mar",
        "04" ~ "apr", 
        "05" ~ "may",
        "06" ~ "jun",
        "07" ~ "jul",
        "08" ~ "aug",
        "09" ~ "sep",
        "10" ~ "oct",
        "11" ~ "nov",
        "12" ~ "dec") 
    ) |> 
  mutate(
    president = case_when(
      prez_gop >= 1 ~ "gop",
      prez_dem >= 1 ~ "dem"
    )
  ) |> 
  select(-day, -prez_dem, -prez_gop) |> 
  mutate(year = as.integer(year))
```

Import and clean snp data
```{r message=FALSE}
snp_df = read_csv(file="./data/fivethirtyeight_datasets/snp.csv") |> 
  separate(
    col = "date",
    into = c("month", "day", "year"),
    sep = "/"
  ) |>
  #in order to correctly sort we need to recast the strings for year and month as integers
  mutate(
    year = case_when(
      as.integer(year) <= 15 ~ as.integer(year) + 2000,
      as.integer(year) > 15 ~ as.integer(year) + 1900
    ),
    month = as.integer(month)
  ) |> 
  relocate("year", "month",  "day") |> 
  arrange(year, month, day) |> 
  #now that we've arranged year and month we can change month number month name to match pos_month_df
  mutate(
    month = 
      case_match(
        month, 
        1 ~ "jan", 
        2 ~ "feb",
        3 ~ "mar",
        4 ~ "apr", 
        5 ~ "may",
        6 ~ "jun",
        7 ~ "jul",
        8 ~ "aug",
        9 ~ "sep",
        10 ~ "oct",
        11 ~ "nov",
        12 ~ "dec") 
    ) |> 
  select(-day) |> 
  rename(snp_close=close)
```

Import and tidy unemployment data

```{r message=FALSE}
unemployment_df = read_csv(file="./data/fivethirtyeight_datasets/unemployment.csv") |> 
  janitor::clean_names() |> 
  pivot_longer(
    jan:dec,
    names_to = "month", 
    values_to = "unemployment"
  )
```

Join all datasets
```{r}
fte_df = left_join(pols_df, snp_df, by = c("year", "month")) |> 
  left_join(unemployment_df, by = c("year", "month"))
```

These datasets contained information about the United States from `r range(select(fte_df, year))[1]` to `r range(select(fte_df, year))[2]`. The pols-month dataset contains information about the number of politicians who are republican or democrat at a given year/month. The snp dataset contains the closing values of the S&P stock market index for a year/month, selected on a given day either the 1st, 2nd, 3rd or 4th of the month. The unemployment dataset
contains the percentage of unemployment at a given month/year.

The resulting dataset has a dimension of `r dim(fte_df)` and covers `r range(select(fte_df, year))[1]` to `r range(select(fte_df, year))[2]`. The variables are `r unique(colnames(fte_df))`.

## Problem 2

```{r}
mr_tw_df = read_excel('./data/202409 Trash Wheel Collection Data.xlsx', range="Mr. Trash Wheel!A2:N653") |> 
  janitor::clean_names() |> 
  mutate(
    machine = 'mr',
    sports_balls = as.integer(round(sports_balls))
  ) |> 
  #month and year are redundant to date so let's remove them and then parse the date column
  select(-month, -year) |> 
  separate(
    col = "date",
    into = c("year", "month", "day"),
    sep = "-"
  ) |> 
  mutate (
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  )


prof_tw_df = read_excel('./data/202409 Trash Wheel Collection Data.xlsx', range="Professor Trash Wheel!A2:M120") |> 
  janitor::clean_names() |> 
  mutate(
    machine = 'prof',
  ) |> 
  select(-month, -year) |> 
  separate(
    col = "date",
    into = c("year", "month", "day"),
    sep = "-"
  ) |> 
  mutate (
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  )

gwyn_tw_df = read_excel('./data/202409 Trash Wheel Collection Data.xlsx', range="Gwynnda Trash Wheel!A2:L265") |> 
  janitor::clean_names() |> 
  mutate(
    machine = 'gwyn',
  ) |> 
  select(-month, -year) |> 
  separate(
    col = "date",
    into = c("year", "month", "day"),
    sep = "-"
  ) |> 
  mutate (
    year = as.integer(year),
    month = as.integer(month),
    day = as.integer(day)
  )


tw_df = bind_rows(mr_tw_df, prof_tw_df, gwyn_tw_df) |> 
  relocate(machine, year, month, day)
```



